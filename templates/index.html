<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tomorrow Exercise — Welcome</title>

  <!-- PWA / theming -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#0b6efd" />
  <meta name="mobile-web-app-capable" content="yes" />
  <link rel="apple-touch-icon" href="/static/icons/icon-192.png">

  <link rel="stylesheet" href="/static/css/styles.css">
<style>
/* ===== ENERGY FITNESS THEME (no layout changes) ===== */

:root{
  --accent:#ff5a2f;              /* main energy */
  --accent-soft:#ff8a4d;
  --accent-glow:rgba(255,90,47,.35);
  --bg-main:#0e1116;
  --bg-panel:#151a21;
  --bg-card:#1b212a;
  --border:#262e39;
  --muted:#9aa4b2;
  --text:#e6edf5;
}

/* base */
html,body{
  height:100%;
  margin:0;
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  background:radial-gradient(circle at 50% -20%, #1a1f27 0%, #0e1116 55%);
  color:var(--text);
  -webkit-font-smoothing:antialiased
}

main.center-wrap{
  min-height:100vh;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding:28px 16px;
  box-sizing:border-box
}

/* cards */
.card{
  background:linear-gradient(180deg,var(--bg-panel),var(--bg-card));
  border-radius:16px;
  box-shadow:
    0 18px 45px rgba(0,0,0,.65),
    inset 0 1px 0 rgba(255,255,255,.03);
  border:1px solid var(--border);
  padding:18px;
  width:100%;
  max-width:920px;
  box-sizing:border-box
}

.auth-card{max-width:420px;margin:20px auto;text-align:center}

/* branding */
.brand{font-weight:800;margin:0;font-size:20px;letter-spacing:.4px}
.brand .accent{
  color:var(--accent);
  text-shadow:0 0 14px var(--accent-glow);
}

.tag{color:var(--muted);font-size:13px;margin:6px 0 12px}

/* inputs */
.auth-form input,
.auth-form textarea,
.auth-form select{
  width:100%;
  padding:12px;
  border:1px solid var(--border);
  border-radius:12px;
  margin-bottom:8px;
  font-size:15px;
  background:#0f1318;
  color:var(--text);
  transition:.18s ease;
}

.auth-form input::placeholder{color:#6f7a88}

.auth-form input:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(255,90,47,.15);
}

.row{display:flex;gap:8px}
.row input{flex:1}

/* buttons */
.actions{display:flex;gap:8px;flex-direction:column}

.btn{
  padding:10px 12px;
  border-radius:12px;
  border:0;
  font-weight:700;
  cursor:pointer;
  letter-spacing:.3px;
  transition:.15s ease;
}

.btn.primary{
  background:linear-gradient(90deg,var(--accent),var(--accent-soft));
  color:#120a06;
  box-shadow:0 6px 20px var(--accent-glow);
}

.btn.primary:active{transform:scale(.97)}

.btn.ghost{
  background:transparent;
  border:1px solid var(--border);
  color:var(--accent);
}

.btn.ghost:hover{
  background:rgba(255,90,47,.08)
}

.tiny-note{font-size:11px;color:var(--muted);margin-top:8px}

/* hub */
.hub{display:flex;flex-direction:column;gap:14px}
.hub-header{display:flex;justify-content:space-between;align-items:center;padding:6px 0}
.hub-actions{display:flex;gap:8px}

/* categories */
.category-row{display:flex;gap:10px;overflow-x:auto;padding:6px 0}

.cat-pill{
  flex:0 0 auto;
  padding:10px 14px;
  border-radius:999px;
  background:#0f1318;
  border:1px solid var(--border);
  min-width:120px;
  text-align:center;
  font-weight:600;
  cursor:pointer;
  color:var(--muted);
  transition:.18s ease;
}

.cat-pill.active{
  background:linear-gradient(90deg,var(--accent),var(--accent-soft));
  color:#120a06;
  border:0;
  box-shadow:0 6px 20px var(--accent-glow);
}

/* routines */
.routine-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}

.routine-card{
  background:linear-gradient(180deg,#11161c,#0f1318);
  border-radius:14px;
  padding:10px;
  box-shadow:0 8px 22px rgba(0,0,0,.55);
  display:flex;
  flex-direction:column;
  gap:8px;
  text-decoration:none;
  color:inherit;
  border:1px solid var(--border);
  transition:.18s ease;
}

.routine-card:hover{
  transform:translateY(-4px);
  box-shadow:0 14px 30px rgba(0,0,0,.7);
}

.routine-thumb{
  height:120px;
  border-radius:10px;
  background:#0b0e12;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  border:1px solid #222933;
}

.routine-title{font-weight:700;font-size:14px;margin:0}
.routine-meta{font-size:12px;color:var(--muted)}

.routine-actions{display:flex;gap:8px;align-items:center;justify-content:space-between}

.save-btn{
  padding:8px 10px;
  border-radius:10px;
  border:0;
  background:linear-gradient(90deg,var(--accent),var(--accent-soft));
  color:#120a06;
  cursor:pointer;
  font-weight:800;
}

.remove-btn{
  padding:6px 8px;
  border-radius:10px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--accent);
  cursor:pointer;
}

/* install banner */
.install-banner{
  position:fixed;
  left:12px;
  right:12px;
  bottom:18px;
  background:linear-gradient(180deg,#151a21,#10151b);
  border-radius:14px;
  padding:10px 14px;
  box-shadow:0 18px 40px rgba(0,0,0,.7);
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:space-between;
  z-index:999;
  border:1px solid var(--border);
}

.install-banner .msg{font-weight:700;color:var(--text)}

@media(min-width:720px){
  .routine-grid{grid-template-columns:repeat(3,1fr)}
}
@media(min-width:1100px){
  .routine-grid{grid-template-columns:repeat(4,1fr)}
  .auth-card{max-width:720px}
}
</style>

</head>
<body>
  <main class="center-wrap" id="appRoot">
    <!-- AUTH -->
    <section id="authSection" class="card auth-card" aria-labelledby="brandTitle">
      <h1 id="brandTitle" class="brand">Tomorrow <span class="accent">Exercise</span></h1>
      <p class="tag">Move. Breathe. Become tomorrow’s best you.</p>

      <form id="authForm" class="auth-form" autocomplete="off">
        <input id="username" name="username" placeholder="Username" required />
        <div class="row">
          <input id="age" name="age" type="number" placeholder="Age" min="8" max="120" required />
          <input id="country" name="country" placeholder="Country" required />
        </div>
        <input id="occupation" name="occupation" placeholder="Occupation (optional)" />
        <div class="actions">
          <button id="startBtn" class="btn primary" type="submit">Get started</button>
          <!-- Guest option kept in DOM to avoid JS errors but disabled to enforce registration-first -->
          <button id="guestBtn" class="btn ghost" type="button" disabled title="Guest mode disabled — please register">Try as Guest</button>
        </div>
      </form>

      <p class="tiny-note">By continuing you accept the offline-first experience. Registration is required to access routines.</p>
    </section>

    <!-- HUB (hidden until registration completes) -->
    <section id="hubSection" class="card hub" hidden>
      <header class="hub-header">
        <div>
          <h2 id="welcomeText">Welcome</h2>
          <p id="subText">Choose a routine to begin — offline-ready once saved.</p>
        </div>
        <div class="hub-actions">
          <button id="installBtn" class="btn ghost" style="display:none">Install App</button>
          <!-- hide header actions until openHub reveals them -->
          <button id="editProfile" class="btn" title="Edit profile" hidden>Edit Profile</button>
          <button id="signOut" class="btn ghost" hidden>Sign out</button>
        </div>
      </header>

      <div class="category-row" id="categoryRow" role="navigation" aria-label="Categories"></div>

      <div class="routine-grid" id="routineGrid" role="list"></div>
    </section>
  </main>

  <!-- Install banner (hidden by default) -->
  <div id="installBanner" class="install-banner" style="display:none;">
    <div class="msg">Install Tomorrow Exercise for an app-like experience.</div>
    <div class="actions">
      <button id="bannerInstall" class="btn primary">Install</button>
      <button id="bannerDismiss" class="btn ghost">Maybe later</button>
    </div>
  </div>

  <!-- small inline guard: ensure hub is hidden unless a user exists in localStorage -->
  <script>
    (function(){
      try {
        const u = localStorage.getItem('te_user');
        // if no user object, ensure auth is visible and hub hidden
        if(!u) {
          const auth = document.getElementById('authSection');
          const hub = document.getElementById('hubSection');
          if(auth) auth.hidden = false;
          if(hub) hub.hidden = true;
        } else {
          // if a stored user exists but registered flag not true, still force auth
          try {
            const j = JSON.parse(u);
            if(!(j && j.registered)) {
              const auth = document.getElementById('authSection');
              const hub = document.getElementById('hubSection');
              if(auth) auth.hidden = false;
              if(hub) hub.hidden = true;
            }
          } catch(e){
            const auth = document.getElementById('authSection');
            const hub = document.getElementById('hubSection');
            if(auth) auth.hidden = false;
            if(hub) hub.hidden = true;
          }
        }
      } catch(e){
        // silently ignore storage errors and default to auth visible
        const auth = document.getElementById('authSection');
        const hub = document.getElementById('hubSection');
        if(auth) auth.hidden = false;
        if(hub) hub.hidden = true;
      }
    })();
  </script>

  <script src="/static/js/idb.js"></script>
  <script src="/static/js/main.js"></script>
  <script>
    // service worker registration is handled inside main.js already
  </script>
</body>
</html>
